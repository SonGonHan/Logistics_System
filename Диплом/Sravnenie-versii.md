#диплом #сравнение-версий

# Сравнение базовой и расширенной версий архитектуры

## Быстрое сравнение

| Параметр | Базовая версия (для диплома) | Расширенная версия (Full Production) |
|----------|------------------------------|---------------------------------------|
| **Количество сервисов** | 4 | 6 |
| **Количество модулей** | 11 | 15 |
| **Схемы БД** | 7 | 10 |
| **Время разработки** | 4 месяца | 9-10 месяцев |
| **Сложность** | Средняя | Высокая |
| **Команда** | 1 разработчик | 2-3 разработчика |
| **GPS-отслеживание** | ❌ Нет | ✅ Да (реал-тайм) |
| **Расчет ETA** | ❌ Нет | ✅ Да |
| **Notification Service** | ❌ Нет (Spring Mail) | ✅ Да (отдельный сервис) |
| **Асинхронная обработка** | ❌ Нет (REST только) | ✅ Да (RabbitMQ) |
| **Мониторинг** | ❌ Нет | ✅ Да (Prometheus + Grafana) |
| **Distributed Tracing** | ❌ Нет | ✅ Да (Jaeger) |
| **Логирование** | ❌ Простое (console) | ✅ Централизованное (ELK) |
| **Кэширование** | ❌ Нет | ✅ Да (Redis) |
| **Circuit Breaker** | ❌ Нет | ✅ Да (Resilience4j) |
| **Edge Service** | ❌ Встроен в User Service | ✅ Отдельный сервис |
| **WebSocket** | ❌ Нет | ✅ Да (реал-тайм треккинг) |

---

## Детальное сравнение по сервисам

### Сервис 1: User & Auth / User Management

| Компонент | Базовая | Расширенная |
|-----------|---------|-------------|
| **API Gateway** | Встроен в User Service | Отдельный Edge Service |
| **OAuth2** | ❌ Нет | ✅ Да |
| **2FA** | ❌ Нет | ✅ Да |
| **Refresh tokens** | ❌ Нет | ✅ Да |

### Сервис 2: Notification Service

| Компонент | Базовая | Расширенная |
|-----------|---------|-------------|
| **Отдельный сервис** | ❌ Нет | ✅ Да |
| **Email** | ✅ Spring Mail | ✅ Spring Mail + шаблоны |
| **SMS** | ❌ Нет | ✅ Twilio API |
| **Push** | ❌ Нет | ✅ Firebase FCM |
| **RabbitMQ очередь** | ❌ Нет | ✅ Да |
| **Retry механизм** | ❌ Нет | ✅ Да |
| **Персонализация** | ❌ Нет | ✅ Да |

### Сервис 3: Core Business Service

| Компонент | Базовая | Расширенная |
|-----------|---------|-------------|
| **Waybill Module** | ✅ Базовый | ✅ Полный + шаблоны |
| **Pricing Module** | ✅ Базовый | ✅ + промокоды, динамика |
| **Acceptance Module** | ✅ Базовый | ✅ + ML определение габаритов |
| **Rating Module** | ✅ Базовый | ✅ + автомодерация |
| **События в RabbitMQ** | ❌ Нет | ✅ Да |

### Сервис 4: Logistics Service

| Компонент | Базовая | Расширенная |
|-----------|---------|-------------|
| **Warehouse Module** | ✅ Базовый | ✅ + оптимизация размещения |
| **Delivery Module** | ✅ Базовый | ✅ + оптимизация маршрутов |
| **Geolocation Module** | ❌ Нет | ✅ Полный (GPS-треккинг) |
| **Tracking Module** | ✅ Простой (статусы) | ✅ Полный (ETA, карта, геозоны) |
| **WebSocket API** | ❌ Нет | ✅ Да (реал-тайм) |
| **Redis кэш** | ❌ Нет | ✅ Да (ETA) |

### Сервис 5: Payment & HR Service

| Компонент | Базовая | Расширенная |
|-----------|---------|-------------|
| **Payment Module** | ✅ Базовый (терминал) | ✅ + онлайн-эквайринг |
| **HR Module** | ✅ Базовый | ✅ + отпуска, KPI |
| **Accounting Module** | ✅ Простой | ✅ + 1С интеграция |
| **Payout Module** | ✅ Базовый | ✅ + банковская интеграция |

---

## Сравнение базы данных

### Схемы

**Базовая версия (7 схем):**
1. user_management
2. waybill_service
3. payment_service
4. delivery_service
5. warehouse_service
6. hr_service
7. rating_service
8. shared_data
9. archive

**Расширенная версия (10 схем):**
1. user_management
2. waybill_service
3. payment_service
4. delivery_service
5. warehouse_service
6. hr_service
7. **notification_service** ← новая
8. rating_service
9. shared_data
10. archive

### Ключевые различия в таблицах

| Таблица | Базовая версия | Расширенная версия |
|---------|----------------|---------------------|
| **delivery_service.courier_routes** | Без поля `route_path` | С GPS-треком (JSONB) |
| **delivery_service.completed_routes** | ❌ Не используется | ✅ Используется |
| **delivery_service.geolocation_history** | ❌ Нет таблицы | ✅ Есть (GPS-история) |
| **warehouse_service.cargo_shipments** | Без поля `route_path` | С GPS-треком грузовика |
| **notification_service.*** | ❌ Нет схемы | ✅ 4 таблицы |

---

## Сравнение межсервисной коммуникации

### Базовая версия (синхронная)

```
Client → User & Auth Service (8080)
    ↓ REST API
Core Business Service (8081)
    ↓ REST API
Logistics Service (8082)
    ↓ REST API
Payment & HR Service (8083)
```

**Все взаимодействия через REST API (синхронные)**

### Расширенная версия (гибридная)

```
Client → Edge Service (8080)
    ↓ REST API
User Management (8081)
Core Business (8083)
Logistics (8084)
Payment & HR (8085)

       ↓ RabbitMQ (асинхронные события)
       
Notification Service (8082)
```

**Комбинация REST API + RabbitMQ**

---

## Технологический стек

### Базовая версия

```yaml
Backend:
  - Spring Boot 3.2+
  - Spring Security + JWT
  - Spring Modulith
  - Spring Mail
  - Spring Cloud Gateway (встроен)

Database:
  - PostgreSQL 15+

Infrastructure:
  - Docker
  - Docker Compose
```

### Расширенная версия

```yaml
Backend:
  - Spring Boot 3.2+
  - Spring Security + JWT + OAuth2
  - Spring Modulith
  - Spring Mail + Thymeleaf
  - Spring Cloud Gateway (отдельный)

Database:
  - PostgreSQL 15+

Message Queue:
  - RabbitMQ

Cache:
  - Redis

Monitoring:
  - Prometheus
  - Grafana
  - Jaeger
  - ELK Stack

External APIs:
  - Twilio (SMS)
  - Firebase (Push)
  - Yandex Maps
  - Stripe

Infrastructure:
  - Docker
  - Docker Compose
  - Kubernetes (опционально)
```

---

## Сравнение функциональности

### ✅ Одинаково в обеих версиях:

1. **Регистрация и авторизация**
   - Все роли (UNREGISTERED_CONTACT, CLIENT, сотрудники)
   - JWT токены
   - RBAC (Role-Based Access Control)

2. **Управление накладными**
   - Черновики
   - Оформление
   - Отмена
   - История статусов

3. **Приемка в ПВЗ**
   - Взвешивание
   - Фотофиксация
   - Печать ярлыков

4. **Складская логистика**
   - Поступление
   - Отгрузка
   - Грузоперевозки

5. **Доставка курьерами**
   - Формирование маршрутов
   - Подтверждение доставки
   - Неудачные попытки

6. **Платежи**
   - Наличные
   - Карта (терминал)
   - СБП
   - Возвраты

7. **HR и Бухгалтерия**
   - Карточки сотрудников
   - Расчет зарплат
   - Выплаты

8. **Отзывы**
   - Оценки
   - Комментарии

### ❌ Только в расширенной версии:

9. **GPS-отслеживание**
   - Реал-тайм позиция курьеров
   - GPS-треки маршрутов
   - История перемещений

10. **Расчет ETA**
    - Предсказание времени доставки
    - Обновление каждые 2 минуты
    - Учет пробок

11. **Notification Service**
    - Централизованные уведомления
    - Email + SMS + Push
    - Шаблоны
    - Retry механизм

12. **Асинхронная обработка**
    - RabbitMQ очереди
    - Event-driven архитектура

13. **Мониторинг**
    - Prometheus метрики
    - Grafana dashboards
    - Jaeger трассировка
    - ELK логирование

14. **Геозоны**
    - Автоматические уведомления при входе/выходе
    - Push при приближении курьера

15. **WebSocket API**
    - Отслеживание в реальном времени
    - Интерактивная карта

16. **Продвинутая аналитика**
    - Тепловые карты загруженности
    - Анализ эффективности курьеров
    - Предиктивная аналитика задержек (ML)

17. **Интеграции**
    - Yandex Maps (оптимизация маршрутов)
    - Stripe (онлайн-эквайринг)
    - Twilio (SMS)
    - Firebase (Push)
    - 1С (бухгалтерия)

---

## Оценка трудозатрат

### Базовая версия

| Этап | Недели |
|------|--------|
| Инфраструктура | 1 |
| User & Auth Service | 2 |
| Core Business Service | 4 |
| Logistics Service | 3 |
| Payment & HR Service | 2 |
| Интеграционное тестирование | 2 |
| UI и документация | 2 |
| **ИТОГО** | **16 недель (4 месяца)** |

### Расширенная версия

| Этап | Недели |
|------|--------|
| Инфраструктура (full stack) | 2 |
| Edge Service | 1 |
| User Management Service | 2 |
| Notification Service | 2 |
| Core Business Service | 5 |
| Logistics Service (с GPS) | 5 |
| Payment & HR Service | 3 |
| Мониторинг и логирование | 2 |
| Интеграционное тестирование | 3 |
| UI (Web + Mobile) | 4 |
| Документация | 1 |
| **ИТОГО** | **30 недель (7.5 месяцев)** |

---

## Когда использовать каждую версию

### Используйте базовую версию, если:

✅ Это дипломный проект (срок 4-6 месяцев)  
✅ Команда 1-2 человека  
✅ Нужна быстрая разработка  
✅ Требуется стабильная рабочая система  
✅ Нет опыта с микросервисами  
✅ Бюджет ограничен (нет Twilio, Stripe)  
✅ Достаточно базового функционала  

### Используйте расширенную версию, если:

✅ Это коммерческий проект  
✅ Команда 2-5 человек  
✅ Есть 9-12 месяцев на разработку  
✅ Требуется GPS-отслеживание  
✅ Нужна высокая отказоустойчивость  
✅ Планируется масштабирование  
✅ Есть бюджет на инфраструктуру  
✅ Требуется enterprise-уровень  

---

## Миграция с базовой на расширенную

### Этап 1: Инфраструктура (2 недели)
- Установить RabbitMQ
- Установить Redis
- Настроить Prometheus + Grafana
- Настроить Jaeger
- Развернуть ELK Stack

### Этап 2: Edge Service (1 неделя)
- Выделить API Gateway из User Service
- Перенастроить маршруты
- Настроить rate limiting

### Этап 3: Notification Service (2 недели)
- Создать схему notification_service
- Реализовать email/SMS/push
- Интегрировать с RabbitMQ
- Перенести логику уведомлений

### Этап 4: GPS-отслеживание (3 недели)
- Добавить таблицы geolocation_history
- Реализовать WebSocket API
- Добавить поля route_path
- Внедрить расчет ETA
- Создать интерактивную карту

### Этап 5: Асинхронная обработка (2 недели)
- Настроить RabbitMQ очереди
- Перевести критичные операции на события
- Добавить Circuit Breaker
- Внедрить Saga pattern (опционально)

---

## Рекомендация для диплома

**Начните с базовой версии** — это оптимальный баланс между функциональностью, сложностью и сроками.

После защиты диплома (если проект вам понравится) постепенно добавляйте компоненты из расширенной версии:
1. Сначала — Edge Service
2. Затем — Notification Service
3. Потом — GPS-отслеживание
4. В конце — мониторинг и аналитику

Такой подход позволит вам:
- ✅ Успешно защитить диплом вовремя
- ✅ Получить стабильную рабочую систему
- ✅ Иметь четкий план развития проекта
- ✅ Постепенно осваивать микросервисную архитектуру

**Это честный, реалистичный путь к созданию enterprise-системы.**